<!doctype html>
<html lang="pt">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">

    <title>Tutorial WebCam Blog Jonathas Guerra</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script type="text/javascript" src="webcamjs-master/webcam.min.js"></script>


    <script>
        jQuery(document).ready(function ($) {

            $("#btn_bater_foto").on("click", function () {

                Webcam.snap(function (data_uri) {
                    document.getElementById('results').innerHTML = '<img id="base64image" src="' + data_uri + '"/>';
                    //document.getElementById('miguel_teste').innerHTML = data_uri    ;
                    $("#miguel_teste").val(data_uri);
                });


                var arquivo = $("#miguel_teste").val();
                var ip_servidor = $("#ip_servidor").val();
                // teste = "opie";
                $.ajax({
                    url: 'enviar_imagem.php',
                    data: {arquivo: arquivo,ip_servidor:ip_servidor},
                    context: document.body,
                    success: function (data) {
                        $("#salva").html(data);

                    },
                    type: 'POST'
                });

            });


        });

    </script>
    <script language="JavaScript">


        function mostrar_camera() {
            Webcam.set({
                width: 640,
                height: 480,
                dest_width: 640,
                dest_height: 480,
                crop_width: 300,
                crop_height: 400,
                image_format: 'jpeg',
                jpeg_quality: 100,
                flip_horiz: true
            });
            Webcam.attach('#minha_camera');
        }

        function salvar_foto() {
            document.getElementById("carregando").innerHTML = "Salvando, aguarde...";
            var file = document.getElementById("base64image").src;
            var formdata = new FormData();
            formdata.append("base64image", file);
            var ajax = new XMLHttpRequest();
            ajax.addEventListener("load", function (event) {
                upload_completo(event);
            }, false);
            ajax.open("POST", "upload.php");
            ajax.send(formdata);
        }

        function upload_completo(event) {
            document.getElementById("carregando").innerHTML = "";
            var image_return = event.target.responseText;
            var showup = document.getElementById("completado").src = image_return;
            var showup2 = document.getElementById("carregando").innerHTML = '<b>Upload feito:</b>';
        }

        window.onload = mostrar_camera;
    </script>
    <style type="text/css">
        .container {
            float: left;
            width: 320px;
            height: 480px;
            margin-right: 5px;
            padding: 5px;
        }

        #camera {
            background: #ff6666;
            height: 800px;
        }

        #previa {
            background: #ffc865;
            height: 800px;
        }

        #salva {
            background: #4dea02;
            height: 800px;
        }
    </style>
</head>
<body>
<div class="container" id="camera">
    <p>Servidor:</p>
    <input id="ip_servidor" type="text" style="width: 300px" value="http://94550baedc70.sn.mynetname.net/facepose">
    <p>Externo: http://94550baedc70.sn.mynetname.net/facepose</p>
    <p>Interno: http://192.168.88.211:5000/facepose</p>
    <form><input id="btn_bater_foto" type="button" value="Tirar Foto"></form>
    <div id="minha_camera"></div>
</div>
<div class="container" id="previa">
    <b>Pr√©via:</b>
    <div id="results" style="width: 250px;"></div>
</div>

<div class="container" id="salva">
    <span id="carregando"></span><img id="completado" src=""/>
</div>
<textarea id="miguel_teste"></textarea>

</body>
</htm>